{% extends 'base.html' %}
{% load humanize %}
{% block title %}Task manager | Paid Tasks{% endblock title %}

{% block extra_css %}
<style>
.card {
    border: none;
    box-shadow: 0 0.15rem 1rem rgba(0, 0, 0, 0.1);
}

.table th, .table td {
    vertical-align: middle;
}

.table thead th {
    background-color: #343a40;
    color: white;
    font-size: 0.9rem;
}

.table td {
    font-size: 0.85rem;
}

.btn-sm i {
    font-size: 0.9rem;
}

.btn-outline-info:hover {
    background-color: #0dcaf0;
    color: white;
}

.btn-outline-primary:hover {
    background-color: #0d6efd;
    color: white;
}
.badge {
    font-size: 0.75rem;
    padding: 0.45em 0.6em;
    cursor: pointer;
}
</style>
{% endblock extra_css %}

{% block background-image %}
{% endblock background-image %}

{% block sidebar-content %}
    {% include 'partials/sidebar.html' %}
{% endblock sidebar-content %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="card shadow rounded">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Paid Tasks</h5>
        </div>
        <div class="card-body table-responsive">
            <table id="tasksTable" class="table table-striped table-hover table-bordered align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>Job Number</th>
                        <th>Job Name</th>
                        <th>Status</th>
                        <th>Customer Name</th>
                        <th>Employee</th>
                        <th>Price</th>
                        <th>Paid Amount</th>
                        <th>Remaining Balance</th>
                        <th>Created At</th>
                        <th>Created By</th>
                        <th>Payment Status</th>
                        <th class="text-center">View</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- DataTables will load data here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
$(document).ready(function () {
    $('#tasksTable').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: "{% url 'payments:task_table_data' 'U' %}",
            type: "GET"
        },
        columns: [
            { data: "id" },
            { data: "order_number" },
            { data: "task_name" },
            { data: "status" },
            { data: "customer_name" },
            { data: "employees" },
            { data: "final_price" },
            { data: "paid_amount" },
            { data: "remain_amount" },
            { data: "created_at" },
            { data: "created_by" },
            { data: "payment_status" },
            { data: "actions", orderable: false, searchable: false }
        ],
        dom: '<"dt-toolbar d-flex justify-content-start align-items-center mb-3"lfB>rtip',
        language: {
            lengthMenu: 'Entries: _MENU_'
        },
        buttons: [
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                className: 'btn btn-secondary btn-sm',
                exportOptions: { columns: ':visible' }
            },
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: 'btn btn-success btn-sm',
                exportOptions: { columns: ':visible' }
            },
            {
                extend: 'pdf',
                text: '<i class="fas fa-file-pdf"></i> PDF',
                className: 'btn btn-danger btn-sm',
                exportOptions: { columns: ':visible' },
                customize: function (doc) {
                    doc.styles.tableHeader.fontSize = 8;
                    doc.defaultStyle.fontSize = 7;
                    doc.styles.tableHeader.alignment = 'center';
                    doc.styles.tableBodyOdd.alignment = 'center';
                    doc.styles.tableBodyEven.alignment = 'center';
                    doc.content[1].table.widths = Array(doc.content[1].table.body[0].length + 1).join('*').split('');
                }
            },
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                className: 'btn btn-outline-primary btn-sm',
                exportOptions: { columns: ':visible' },
                customize: function (win) {
                    $(win.document.body).css('font-size', '10pt');
                    $(win.document.body).find('table')
                        .addClass('compact')
                        .css('font-size', 'inherit');
                }
            }
        ]
    });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
    });
});
</script>

{% endblock extra_js %}
